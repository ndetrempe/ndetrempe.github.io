<html>
<script src='https://d3js.org/d3.v5.min.js'></script>

<style>
 circle {stroke: black;}
 
 #tooltip{ opacity: 0;
        position: absolute;
        text-align: center;
        width: 80px; height; 40px;
        background: lightgray;
        border: 2px;
}
</style>
<body onload='init()'>
<svg width=1000 height=1000 id="svg"> </svg>
<div id = "tooltip"></div>
<div id = "legend"></div>


<script>

xdomain = [1983,2020];//min and max numbers
xrange = [200,800];//min and max areas
ydomain = [.01,90];
yrange = [800,200];
v_margin = 200;
h_margin = 200;
xs = d3.scaleLinear().domain(xdomain).range(xrange);
ys = d3.scaleLog().domain(ydomain).range(yrange);
var color = {'Nintendo Entertainment System':'red', 'Super Nintendo Entertainment System':'cyan',
		     'Nintendo 64':'green', 'Nintendo GameCube':'violet', 'Nintendo Wii':'yellow',
			 'Nintendo Wii U':'blue', 'Nintendo Switch':'brown'}
var tooltip = d3.select("#tooltip");
var legend = d3.select("#legend");
var svg = d3.select("#svg");

async function init(data) {

	data = await d3.csv("https://ndetrempe.github.io/nintendo.csv");
	console.log(data);
	svg.append('g')
	 .selectAll('circle')
	 .data(data)
	 .enter()
	 .append('circle')	 
	 .attr('cx', function(d){return xs(d.Year);})
	 .attr('cy', function(d){return ys(d.Total_Shipped);})
	 .attr('r', function(d){if (d.Critic_Score == ''){return '5';} else {return d.Critic_Score;}})
	 .attr('fill', function(d){return color[d.Platform];})	 
	 .on("mouseover", function(d){
        tooltip.style("opacity", 1)
        .style("left", (d3.event.pageX)+"px")
        .style("top", (d3.event.pageY)+"px")
        .html(d.Name + "</p>Released " + d.Year + "</p> Critic Score " + d.Critic_Score);})		
	 .on("mouseout", function() {
        tooltip.style("opacity", 0)
				.style("left", "0px")
				.style("top", "0px")})

	svg.append('g')
		.attr("transform", "translate(180, 0)")
		.call(d3.axisLeft(ys).tickValues([0.01, 0.1, 1, 10, 100]).tickFormat(d3.format(",.2f")));
		
	svg.append('g')
	.attr("transform", "translate(0, 820)")
		.call(d3.axisBottom(xs));
		
	svg.append('text')
		.attr('class', "x label")
		.attr('x', 450)
		.attr('y', 860)
		.text("Year game was released");
		
	svg.append('text')
		.attr('class', "y label")
		.attr('x', 10)
		.attr('y', 500)
		.text("Total copies shipped");
		
	svg.append('text')
		.attr('class', "y label")
		.attr('x', 50)
		.attr('y', 520)
		.text("(millions)");
	
	
	pos = 200;
	for (const obj in color){
		svg.append('circle')
		.attr('cx', 840)
		.attr('cy', pos)
		.attr('r', 6)
		.attr('fill', color[obj]);
		
		svg.append('text')
		.attr('x', 860)
		.attr('y', pos + 5)
		.style('fill', color[obj])
		.text(obj);
		pos += 20;
		}
}
</script>
</body>
</html>